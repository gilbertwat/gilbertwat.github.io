- Interview of Jeffy on One Year Internship
    - {{[[DONE]]}}  Record on BambooHR
    - Data scientist
        - HKObservatory
- Interview of Bosco on Full stack Engineer
    - {{[[DONE]]}}  Record on BambooHR
    - Interview Notes
        - Flutter
            - Map API
            - Camera API PoC
                - Merge Template and overlay
                - Flutter Framework can do it?
                    - Not working
                        - Native
                        - Cropping Image
            - Most challenging
                - Merge image in Canvas API
                    - Calculation
                - No plugin can do it
                    - cannot text align
                    - cannot show Cantonese
                - Go raw
                    - Cannot download image in the hill
                    - WebGL
                        - matrix computation
            - Future
                - Architectural
                    - Extendibility
                    - Fast and agile
                - backend security
            - lottery
                - docker-compose
                - typescript-express
                - postgresql
- {{[[DONE]]}}  [[[[Preface]] source new wordpress blog hosting provider]] evaluation
    - Evaluation: preface.ai migration
    - Dated: May 25, 2022
    - # Success Criteria Recap and evaluation
        - **Better SEO score:** üòê
        - To a certain degree we can have a better SEO score, as the performance is better
        - **Better Web vital score** [core-web-vitals (SEO-Tech)](https://docs.google.com/spreadsheets/d/1Tw2iihPJJg1Zl3BV3F6s9U_t3Fx2DJDMq1NjYnWlSsM/edit?usp=sharing) ‚úÖ
        - In research of a better measurement of website performance we came across [PageSpeed Insights](https://pagespeed.web.dev/) and we scored a 1-2 point improvement in mobile and 4-6 point improvement in Desktop.
        - **Better latency for all visitors. We will focus on the visitors from Hong Kong, the United States, Japan and the United Kingdom. **üòê
        - From the subjective feeling from some of the end users, the latency is lower than the old infrastructure, unfortunately we have no real data for now.
        - **Momo is no longer required to participate in updating preface.ai ‚úÖ******Yep, no doubt about it. Only when we need to update the API from the portal
        - **Remove Github Action from our infrastructure ‚úÖ**
        - Yep. We no longer need the github action and we are going to downgrade our plan from enterprise to developer
        - **We are able to hire rails engineer and javascript engineer in two separate roles. ‚úÖ******Yep. We can do so now. Whether we choose to do so is based on our business and team needs.
    - # Possible Negative Impact & Mitigation Recap
        - **Unscheduled downtime after migration******Thank god it doesn‚Äôt happen.
    - # Unforeseen events and wins
    - ## Github Artifact Size and Enterprise Plan
        - See [[[[Preface]] [[post mortem]] 4]]
    - ## Decrease in performance of our blog
        - See [#6 Degradation of Blog performance after website infrastructure migration](https://docs.google.com/document/d/1NRGYgC3dXcWtbA8a1_ac2AyGlR0cPVfHBwZGDovQBUc/edit)
    - ## Simpler infrastructure
        - See [#6 Degradation of Blog performance after website infrastructure migration](https://docs.google.com/document/d/1NRGYgC3dXcWtbA8a1_ac2AyGlR0cPVfHBwZGDovQBUc/edit)
        - We turned out to remove Cloudflare Worker from our infrastructure, resulting in a cleaner infrastructure. See [Preface Blog: Technical](https://docs.google.com/document/u/0/d/1Vj0bpucxyhK7zSoQgb3OLxM1lgsIoJ3p30k-3GBj-vI/edit) also as a reference.
    - ## Wix Annual Pass website setup
        - We made a 1 pager for promoting and collecting payment for our annual pass initiatives. Operator mistakenly linked preface.ai with the wix site, resulting in a period of DNS ‚Äúpollution‚Äù. Some of our users may be redirected to an empty wix site page instead of our new Vercel.
    - # References:
        - Performance on **desktop** of our new infrastructure![](https://lh5.googleusercontent.com/msL-_zSHhTI_CmdP27O85wdpCsn8fnQ5awmkXttDHvsRkAgcav9pr5abRggrvPnRP8dYEFt4RSYN6eAFE0KtFTaR6b-M1eWYkmBFltSSf9wX_rYOiq2TDOqQ7KLHua-O4YLP_xmPKojDMK30DQ) Performance on **desktop** of our old infrastructure![](https://lh5.googleusercontent.com/b_l1qYThM29jd-SNM2ijoRgPeswNun4YEAAYRC3JIET7jdHfl1ZBmwZYIv3Tfo8BBUPd2SzOq5uxusyWraxR9WdQAa_2GcGEZ8gidlOivyq-2W6LV0zVQIVtSUHUq9RXq_ZNP2YyTDTaJ5L4cg)
        - Performance on __mobile__ of our old infrastructure
        - ![](https://lh5.googleusercontent.com/sttM2I1ElL8M0kp84X1d7vGykSlfa-aqTaMzK08bxdeMrg2m1-pKikf9AprNwJ4Di6cmnR67oYusduz9LKSWnXSGAclO8rnhnuCBq9lw8je7Jrna06dzRPqDp9BilYkeub9Xc2wQQ2rX8r2q2A)
        - Performance on **mobile** of our old infrastructure
        - ![](https://lh4.googleusercontent.com/Y_tbRThZpHHQ8oHle1S8j_eSwijpDDITURUtts_6hux0XVg2YPTdPEDZkOHRp0mVevHvZiSwqVsITYm-YaNN8eo8ZHkmle2oyS4RUykG6Vr4I1TKZaT5MX0wMFeXq-f-sF5Gv1WMzfVZwe-W0g)
- 
    - # Our Website Checkout page failed to navigate to Stripe payment page for a week.
    - # Summary of the incident
        - Sales team has reported on the last day of the long holiday that there are customers failing to check out their order via our website.
        - In the coming working day, we looked into this issue and found that the issue can be reproduced in staging and local environments.
        - In short, the customer is expected to be redirected to the Stripe Checkout page after clicking the ‚ÄúPay‚Äù button in the checkout page, but this is not pointing to an error page from Stripe during the incident.
        - We find that a key required by Stripe SDK has failed to be assigned in the run time. After investigation, this is related to a recent code change in the website project.
        - To provide some background information, we are in parallel working on another project which is¬† to separate our website from the portal code base.
        - So, the said minor code changes are aimed to solve an issue that we cannot test the Stripe payment in our local environment. This code changes work well also in the testing environment of the website separation project.
        - However, this will not work in the actual production version of our website, where our website code will get transpiled and converted into Ruby erb code under the Portal project. The information of the Stripe required key will be lost in build time, thus resulting in the issue.
    - # Timeline of key events
        - **Monday [[April 18th, 2022]]**
        - **4:49 pm** - Sales Team reported there is 1 customer report he/she cannot settle the order payment via our website. Sales team has already helped generate a Payment link for that customer to settle their payment again.
        - **5:15 pm** - We looked into the issue via the order records and found that this customer has completed the payment already via the payment link method.
        - **Tuesday [[April 19th, 2022]]**
        - **06:00 pm** - We start investigating the issue
        - **06:26 pm** - After some verification, we are able to reproduce the issue via the staging environment.
        - **07:00 pm** - A further investigation found out the root cause of the problem
        - **07:27 pm** - A Pull request has been made aiming to hot-fix the issue.
        - **07:32 pm** - We are expecting our CD process will automatically deploy the code change to our testing environment but in fact there is incident also in Heroku(our cloud provider) which block all the git integration
        - See this Heroku incident:
        - https://status.heroku.com/incidents/2413
        - **08:00 pm** - We find the proper way to workaround the issue and start deploying the code change to the staging environment.
        - **08:10 pm** - The fix has been deployed to the staging environment and has passed our verification. We start working on manually deploying the fix to production environment
        - **08:37 pm** - The fix has been deployed to production environment also
    - # Key metrics
    - ## Time to Recovery
        - 1 week
    - # Business Impact
        - Customers during the incident time can not pay directly from our website.
        - On the other hand, their order checkout action has still been captured by the portal system. Their contact information has been recorded.
        - So, our Sales team is able to follow up their orders 1 by 1 and generate a new Payment link for them to settle the order.
    - # Why is it happening?
        - We don‚Äôt have enough knowledge on the original coupling development workflow(the code in the website project will be transpile and converted into Ruby erb code under the Portal project).
        - So when we try to solve the local development issue when we work on separating them, we don‚Äôt see the consequence of our code change actually may break the original workflow.
    - # Prevention & Mitigation
    - ## Short term (< 3months)
        - Similar issues won‚Äôt happen any more **ONCE** our website gets separated from the portal.
            - It won't transpile and convert to Ruby erb code in the Portal codebase any more.
            - It should be safe to always presume the code running in our local environment works exactly the same way in our other environments
    - ## Long term (> 3 months)
        - We should have either automation test/manually test process in place which cover all important business behaviour, such that we can spot critical issues as early as possible
        - Internal users are not used to test our digital product(mainly our website and portal) in our staging environment. But business important behavior is hard to be tested on production environment right now(since it involved settling order with real payment), We should either advocate more on stagin environment use(not recommended) or try to enable internal user to test out important component with less to no cost
            - Brainstorming: allow placing testing orders with $1? Allow placing testing order which bind to Stripe testing accounts(sound risky)?
        - Any more?
    - # References
        - https://github.com/preface-ai/preface-website-frontend/pull/357
        - https://github.com/preface-ai/preface-website-frontend/pull/327
- {{[[DONE]]}}  [[[[Preface]] [[post mortem]] 6]]
    - # Blog performance degradation
    - Our blog suffered from a performance degradation after our website migration for 1 week.
    - # Summary of the incident
        - Since our migration of preface.ai, our blog is no longer behind the Cloudflare CDN. And the CDN in Vercel is unable to cache most of the requests for our blog. The hosting provider of our blog has very limited capabilities. Fixing it on the existing infrastructure was considered impossible.
        - Both BGM team and tech team decided to speed up the [2 blog hosting migration [DONE]](https://drive.google.com/open?id=17EOTmupB0W5ArXT2HfPjNc77smyotKVg) project and result in a satisfactory outcome.
    - # Timeline of key events
        - **[[May 13th, 2022]]****: **preface.ai is migrated to the new infrastructure.
        - **[[May 13th, 2022]]****: **BGM team and tech team recognize there is a degradation of blog performance.
        - **[[May 16th, 2022]]****: **BGM team and tech team decided to speed up the migration project.
        - **[[May 18th, 2022]]**: Backup of old blog has started.
        - **[[May 19th, 2022]]**: Backup of old blog has completed.
        - **[[May 19th, 2022]]**: An UAT of our new blog infrastructure started.
        - **[[May 20th, 2022]]**: New blog infrastructure in place
    - # Key metrics
    - ## Time to Recovery
        - 1 week
    - # Business Impact
        - 1 week of degraded performance of our blog, resulting in not optimal blog lead-generation efforts.
    - # Why did it happen?
        - Cloudflare and Vercel cannot work seamlessly together. They have different SSL certificate infrastructure. So the only way for them to coexist is setting Cloudflare to `DNS only` instead of `Proxied`.
        - `Proxied` is a must for the essential Cloudflare Worker to function. When the Cloudflare Worker ceased to function, the blog was no longer cached properly. Non-cached requests will be directed to the old infrastructure. The old infrastructure has a limited CPU and RAM. To aggravate the latency problem, the old infrastructure is based in the US, and most of our visitors of blog are from Hong Kong, the network round trip is noticeable to our visitors.
        - The latency problem has also affected our SEO effort as SEO score has a component of performance. The degradation of performance has led to a hit in our SEO ranking.
        - The migration is more complicated because of a few reasons.
            - The Cloudflare Worker logic is convoluted and coupled.
            - The limited capabilities of the admin panel and computing resources of the old infrastructure is the reason why we cannot compress our 17GB of wordpress folder and 500MB of data in MySQL.
            - The slow network from old infrastructure to local machines was going to take 5 days for us to download everything locally. We have resolved this by using a DigitalOcean machine in SF to download 17GB of data from old infrastructure. It has taken 16 hours to complete.
            - FTP protocol requires 1 handshake per file. The whole wordpress site has 1000+ of files.
            - 17GB of data and code in wordpress is slow to decompress in the new infrastructure.
            - No SSH capability in old infrastructure so we cannot use more reliable tools such as rsync to download data.
            - DNS requires up to 48 hours to update.
    - # Prevention & Mitigation
        - Not applicable as we have fixed our problems at the root.
    - # References
        - https://vercel.com/support/articles/using-cloudflare-with-vercel
        - https://developers.cloudflare.com/dns/manage-dns-records/reference/proxied-dns-records
        - __Network Traffic of the migration of the whole wordpress site data and files.__
        - ![](https://lh6.googleusercontent.com/9GmNViTc78-AaVa9WzpX69H9c2U_0Wb9UOPJ6-cmZyMddPTqDTx86aT_QvT2644U3rERuuugG2WkXbYOvZWGUUZ9Id-1s_vfKK8ZnxEH3M_nyFyJdfLPdKJLlopHFirQzE7UbhsQsG7D1CaTaQ)
